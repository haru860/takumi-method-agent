---
name: planning-causal-loop-diagram
description: 因果関係ループ図の作成を実行
---

# 因果関係ループ図の生成

**追加指示（引数）**: $ARGUMENTS

**前提条件**:
- Phase 4が完了している
- `output/requirement-tree-business.tsv` が存在する
- `output/requirement-tree-it.tsv` が存在する
- `output/requirement-tree-activity.tsv` が存在する

**目的**: 要求分析ツリーを元に、システム思考に基づいた因果関係ループ図を生成し、企画が最も効果的に進むための施策の進め方を可視化する

## 因果ループ図

### 因果ループ図とは

因果ループ図とは、複数の要素がどのように因果関係で結びつき、互いに影響し合っているかを可視化する図です。

要素同士を矢印で結び、その関係が「正の関係（増えれば増える）」か「負の関係（増えれば減る）」かを示します。さらに、因果の連鎖が循環している部分（ループ）を明らかにすることで、システム全体の振る舞いや構造的なパターンを理解します。

因果ループ図は、問題の表面的な事象ではなく、その背後にある構造を捉えるための思考ツールです。施策がどのような波及効果を生むのか、どこにレバレッジポイントがあるのかを検討する際に活用されます。

### レバレッジポイントとは

システム全体に大きな変化をもたらす影響力の高い介入点のことです。

因果関係で結ばれた要素の中で、わずかな変更や働きかけによって、連鎖的に全体の振る舞いを変えられるポイントを指します。単なる対症療法ではなく、構造そのものに作用する場所である点が特徴です。

レバレッジポイントを見極めることで、少ない資源で効果的な改善を実現できます。そのため、因果ループ図などを用いてシステムの構造を理解し、どこに介入すべきかを検討することが重要です。


---

## 実行手順

### 手順1: 前提条件の確認

`Glob` ツールで以下のファイルが存在することを確認：
- `output/requirement-tree-business.tsv`
- `output/requirement-tree-it.tsv`
- `output/requirement-tree-activity.tsv`

存在しない場合は、先にPhase 4（`/requirement-tree-all`）を実行するよう案内する。

### 手順2: 既存ファイルの削除

`output/causal-loop-diagram.md` が存在する場合は削除する。

**注意**: ユーザー確認は不要。存在すれば自動的に削除して続行する。

### 手順3: エージェントの起動

`Task` ツールで `CausalLoopDiagramGenerator` エージェントを起動する。

**エージェントへの追加指示**: 上記の「追加指示（引数）」が空でない場合、その内容をエージェント起動時のプロンプトに含めて渡すこと。

### 手順4: 因果関係ループ図ファイルの出力

**【重要】エージェント完了後、Agentが設計した因果関係ループ図のデータを受け取り、必ず以下を実行**:

`Write` ツールで以下を作成：

- **ファイルパス**: `output/causal-loop-diagram.md`
- **ファイル形式**: Markdown形式（Mermaid.jsコードブロックを含む）
- 概要、図、分析結果を含める
- **【重要】Mermaidのstyle定義では必ず `color:#000` を含めて文字色を黒にすること**
  - 例: `style A fill:#FFD700,stroke:#FF8C00,stroke-width:4px,color:#000`

### 手順5: 出力確認

`Glob` ツールで `output/causal-loop-diagram.md` の存在を確認。
ファイルが存在しない場合は、手順4に戻りWriteツールでファイルを作成する。

---

## 完了時の動作

- 出力したファイル名を報告
- 特定したレバレッジポイントと推奨する施策の優先順位を要約して報告

---

## 使用例

```bash
# 基本的な実行
/planning-causal-loop-diagram

# フェーズ別の詳細図も作成
/planning-causal-loop-diagram フェーズ別の詳細図も作成してください

# 特定のループにフォーカス
/planning-causal-loop-diagram 人材育成に関するループを詳細に分析してください
```
